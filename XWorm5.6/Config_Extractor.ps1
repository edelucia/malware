# www.emanueledelucia.net                                          #
# XWorm 5.6 Configuration Extractor                                #
# This code is provided as is and without any warranty.            #
# Be careful to only work with malware in controlled environments. #
# Author: Emanuele De Lucia                                        #
####################################################################

$executablePath = "[mypath]\[myexe].exe"

Add-Type -AssemblyName System.Reflection
$assembly = [Reflection.Assembly]::LoadFile($executablePath)

function Decrypt-AES {
    param (
        [string]$encryptedText,
        [byte[]]$key
    )

    $rijndaelManaged = New-Object System.Security.Cryptography.RijndaelManaged
    $md5CryptoServiceProvider = New-Object System.Security.Cryptography.MD5CryptoServiceProvider
    $array = New-Object byte[] 32
    $sourceArray = $md5CryptoServiceProvider.ComputeHash([System.Text.Encoding]::UTF8.GetBytes($mutex))

    [Array]::Copy($sourceArray, 0, $array, 0, 16)
    [Array]::Copy($sourceArray, 0, $array, 15, 16)

    $rijndaelManaged.Key = $array
    $rijndaelManaged.Mode = [System.Security.Cryptography.CipherMode]::ECB

    $cryptoTransform = $rijndaelManaged.CreateDecryptor()
    $encryptedBytes = [System.Convert]::FromBase64String($encryptedText)
    $decryptedBytes = $cryptoTransform.TransformFinalBlock($encryptedBytes, 0, $encryptedBytes.Length)

    return [System.Text.Encoding]::UTF8.GetString($decryptedBytes)
}

$ExtracetedHost = $assembly.GetType('Settings').GetField('Hosts').GetValue($null)
$port = $assembly.GetType('Settings').GetField('Port').GetValue($null)
$key = $assembly.GetType('Settings').GetField('KEY').GetValue($null)
$spl = $assembly.GetType('Settings').GetField('SPL').GetValue($null)
$sleep = $assembly.GetType('Settings').GetField('Sleep').GetValue($null)
$groub = $assembly.GetType('Settings').GetField('Groub').GetValue($null)
$usbnm = $assembly.GetType('Settings').GetField('USBNM').GetValue($null)
$mutex = $assembly.GetType('Settings').GetField('Mutex').GetValue($null)
$loggerPath = $assembly.GetType('Settings').GetField('LoggerPath').GetValue($null)

$decryptedHosts = Decrypt-AES -encryptedText $ExtracetedHost
$decryptedPort = Decrypt-AES -encryptedText $port
$decryptedKey = Decrypt-AES -encryptedText $key
$decryptedSPL = Decrypt-AES -encryptedText $spl
$decryptedGroub = Decrypt-AES -encryptedText $groub
$decryptedUSBNM = Decrypt-AES -encryptedText $usbnm

Set-Content -Path "XWorm_config.txt" -Value @"
Hosts: $decryptedHosts
Port: $decryptedPort
KEY: $decryptedKey
SPL: $decryptedSPL
Groub: $decryptedGroub
USBNM: $decryptedUSBNM
"@
